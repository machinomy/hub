---
- hosts: all
  gather_facts: true

  vars:
    hub_path: '~/hub'

  tasks:
    - name: hub
      git:
        repo: git@github.com:machinomy/hub.git
        dest: "{{ hub_path }}"
        update: yes
        force: yes
        accept_hostkey: yes

    - command: yarn install
      args:
        chdir: "{{ hub_path }}"

    - command: yarn link machinomy
      args:
        chdir: "{{ hub_path }}"

    - command: yarn run build
      args:
        chdir: "{{ hub_path }}"

    - command: pm2 restart ecosystem.json --env staging
      args:
        chdir: "{{ hub_path }}"
